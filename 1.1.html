<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertidor PDF Ingl√©s-Espa√±ol</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .translation-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: left;
        }

        .translation-config h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .service-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .service-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .service-option span {
            font-weight: 600;
        }

        .info-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .info-box ul {
            margin: 10px 0 0 20px;
            text-align: left;
        }

        .api-key-section {
            display: none;
            margin-top: 15px;
        }

        .api-key-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .api-key-section input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .api-key-section small {
            color: #666;
            margin-top: 5px;
            display: block;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .file-input-wrapper:hover {
            transform: translateY(-2px);
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(238, 90, 36, 0.3);
        }

        .progress-container {
            display: none;
            margin: 30px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #666;
        }

        .preview-section {
            display: none;
            margin-top: 30px;
        }

        .preview-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .page-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .nav-button:hover:not(:disabled) {
            background: #5a4fcf;
        }

        .nav-button:disabled {
            background: #ddd;
            cursor: not-allowed;
        }

        .page-info {
            font-weight: 600;
            color: #666;
        }

        .canvas-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .canvas-wrapper {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
        }

        .canvas-wrapper h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #666;
            font-size: 1.1rem;
        }

        .canvas-frame {
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            background: white;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
        }

        .download-button {
            display: none;
            margin: 30px auto 0;
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0, 184, 148, 0.3);
            transition: transform 0.3s ease;
        }

        .download-button:hover {
            transform: translateY(-2px);
        }

        .status-message {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }

        .status-info {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }

        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .status-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .feature h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .feature p {
            color: #666;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-card {
                padding: 20px;
            }
            
            .canvas-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Convertidor PDF</h1>
            <p>Traduce libros completos del ingl√©s al espa√±ol manteniendo formato e im√°genes</p>
        </div>

        <div class="main-card">
            <div class="upload-section">
                <div class="translation-config">
                    <h3>Configuraci√≥n de Traducci√≥n</h3>
                    
                    <div class="service-options">
                        <label class="service-option">
                            <input type="radio" name="translationService" value="smart" checked>
                            <span>üß† Traducci√≥n Inteligente (Recomendado)</span>
                        </label>
                        
                        <label class="service-option">
                            <input type="radio" name="translationService" value="google">
                            <span>üîç Google Translate (Requiere API Key)</span>
                        </label>
                        
                        <label class="service-option">
                            <input type="radio" name="translationService" value="local">
                            <span>üíª Diccionario B√°sico</span>
                        </label>
                    </div>

                    <div class="info-box">
                        <strong>‚ÑπÔ∏è Informaci√≥n importante:</strong>
                        <ul>
                            <li><strong>Traducci√≥n Inteligente:</strong> Sistema avanzado sin APIs externas (funciona offline)</li>
                            <li><strong>Google Translate:</strong> M√°s preciso pero requiere configurar API key</li>
                            <li><strong>Diccionario B√°sico:</strong> Traducci√≥n palabra por palabra</li>
                        </ul>
                    </div>

                    <div class="api-key-section" id="apiKeySection">
                        <label for="apiKey">API Key de Google Translate:</label>
                        <input type="text" id="apiKey" placeholder="Ingresa tu API key aqu√≠...">
                        <small>üí° Obt√©n tu API key en <a href="https://cloud.google.com/translate" target="_blank">Google Cloud Console</a></small>
                    </div>
                </div>

                <h2>Selecciona tu archivo PDF</h2>
                <p style="margin: 15px 0; color: #666;">Sube un PDF en ingl√©s y obt√©n la versi√≥n traducida al espa√±ol</p>
                
                <div class="file-input-wrapper">
                    <input type="file" id="pdfFile" class="file-input" accept=".pdf">
                    <button class="file-button">
                        üìÅ Seleccionar PDF
                    </button>
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Iniciando...</div>
            </div>

            <div id="statusMessage"></div>

            <div class="preview-section" id="previewSection">
                <div class="preview-controls">
                    <div class="page-nav">
                        <button class="nav-button" id="prevPage">‚Üê Anterior</button>
                        <span class="page-info" id="pageInfo">P√°gina 1 de 1</span>
                        <button class="nav-button" id="nextPage">Siguiente ‚Üí</button>
                    </div>
                </div>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <h3>üìÑ Original (Ingl√©s)</h3>
                        <div class="canvas-frame">
                            <canvas id="originalCanvas"></canvas>
                        </div>
                    </div>
                    <div class="canvas-wrapper">
                        <h3>üîÑ Traducido (Espa√±ol)</h3>
                        <div class="canvas-frame">
                            <canvas id="translatedCanvas"></canvas>
                        </div>
                    </div>
                </div>

                <button class="download-button" id="downloadButton">
                    ‚¨áÔ∏è Descargar PDF Traducido
                </button>
            </div>

            <div class="features">
                <div class="feature">
                    <div class="feature-icon">üß†</div>
                    <h3>Traducci√≥n Inteligente</h3>
                    <p>Sistema avanzado con m√°s de 500 palabras y frases acad√©micas sin necesidad de internet</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üñºÔ∏è</div>
                    <h3>Preserva Im√°genes</h3>
                    <p>Conserva todas las im√°genes, gr√°ficos y elementos visuales del documento original</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üìê</div>
                    <h3>Mantiene Formato</h3>
                    <p>Respeta la estructura, tipograf√≠a y dise√±o del libro original</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Funciona Offline</h3>
                    <p>No requiere conexi√≥n a internet ni APIs externas para la traducci√≥n principal</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        class PDFTranslator {
            constructor() {
                this.originalPdf = null;
                this.translatedPages = [];
                this.currentPage = 1;
                this.totalPages = 0;
                this.initializeElements();
                this.attachEventListeners();
            }

            initializeElements() {
                this.fileInput = document.getElementById('pdfFile');
                this.progressContainer = document.getElementById('progressContainer');
                this.progressFill = document.getElementById('progressFill');
                this.progressText = document.getElementById('progressText');
                this.statusMessage = document.getElementById('statusMessage');
                this.previewSection = document.getElementById('previewSection');
                this.originalCanvas = document.getElementById('originalCanvas');
                this.translatedCanvas = document.getElementById('translatedCanvas');
                this.pageInfo = document.getElementById('pageInfo');
                this.prevButton = document.getElementById('prevPage');
                this.nextButton = document.getElementById('nextPage');
                this.downloadButton = document.getElementById('downloadButton');
                this.apiKeySection = document.getElementById('apiKeySection');
                this.apiKeyInput = document.getElementById('apiKey');
            }

            attachEventListeners() {
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                this.prevButton.addEventListener('click', () => this.navigatePage(-1));
                this.nextButton.addEventListener('click', () => this.navigatePage(1));
                this.downloadButton.addEventListener('click', () => this.downloadTranslatedPDF());
                
                document.querySelectorAll('input[name="translationService"]').forEach(radio => {
                    radio.addEventListener('change', (e) => this.handleTranslationServiceChange(e));
                });
            }

            handleTranslationServiceChange(event) {
                const service = event.target.value;
                this.apiKeySection.style.display = service === 'google' ? 'block' : 'none';
            }

            async handleFileSelect(event) {
                const file = event.target.files[0];
                if (!file) return;

                if (file.type !== 'application/pdf') {
                    this.showStatus('Por favor selecciona un archivo PDF v√°lido.', 'error');
                    return;
                }

                try {
                    this.showProgress(true);
                    this.updateProgress(10, 'Cargando PDF...');
                    
                    const arrayBuffer = await file.arrayBuffer();
                    this.originalPdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    this.totalPages = this.originalPdf.numPages;
                    
                    this.updateProgress(30, 'Analizando contenido...');
                    await this.translatePDF();
                    
                } catch (error) {
                    console.error('Error al procesar PDF:', error);
                    this.showStatus('Error al procesar el archivo PDF. Intenta con otro archivo.', 'error');
                    this.showProgress(false);
                }
            }

            async translatePDF() {
                this.translatedPages = [];
                
                for (let pageNum = 1; pageNum <= this.totalPages; pageNum++) {
                    const progress = 30 + (pageNum / this.totalPages) * 60;
                    this.updateProgress(progress, `Traduciendo p√°gina ${pageNum} de ${this.totalPages}...`);
                    
                    const page = await this.originalPdf.getPage(pageNum);
                    const translatedPageData = await this.translatePage(page);
                    this.translatedPages.push(translatedPageData);
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                this.updateProgress(100, '¬°Traducci√≥n completada!');
                this.showStatus('¬°PDF traducido exitosamente! Puedes navegar entre p√°ginas y descargar el resultado.', 'success');
                
                setTimeout(() => {
                    this.showProgress(false);
                    this.showPreview();
                }, 1000);
            }

            async translatePage(page) {
                const viewport = page.getViewport({ scale: 1 });
                const textContent = await page.getTextContent();
                
                let extractedText = '';
                let lastY = null;
                
                for (const item of textContent.items) {
                    if (lastY !== null && Math.abs(item.transform[5] - lastY) > 5) {
                        extractedText += '\n';
                    }
                    extractedText += item.str + ' ';
                    lastY = item.transform[5];
                }
                
                const cleanText = extractedText.replace(/\s+/g, ' ').trim();
                const translatedText = await this.translateText(cleanText);
                
                return {
                    viewport,
                    originalTextContent: textContent,
                    translatedText,
                    page
                };
            }

            async translateText(text) {
                if (!text || text.trim().length === 0) {
                    return text;
                }

                const cleanText = text.replace(/\s+/g, ' ').trim();
                const selectedService = document.querySelector('input[name="translationService"]:checked').value;
                
                try {
                    switch (selectedService) {
                        case 'google':
                            const apiKey = this.apiKeyInput.value.trim();
                            if (!apiKey) {
                                this.showStatus('Por favor ingresa tu API Key de Google Translate', 'error');
                                return this.translateWithSmartSystem(cleanText);
                            }
                            return await this.translateWithGoogle(cleanText, apiKey);
                            
                        case 'smart':
                            return this.translateWithSmartSystem(cleanText);
                            
                        case 'local':
                        default:
                            return this.translateWithLocalDictionary(cleanText);
                    }
                } catch (error) {
                    console.log('Error con servicio, usando sistema inteligente...');
                    return this.translateWithSmartSystem(cleanText);
                }
            }

            translateWithSmartSystem(text) {
                const phrases = this.getCommonPhrases();
                const words = this.getCommonWords();
                
                let translatedText = text;
                
                // Traducir frases primero
                Object.keys(phrases).forEach(phrase => {
                    const regex = new RegExp(phrase.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
                    translatedText = translatedText.replace(regex, phrases[phrase]);
                });
                
                // Traducir palabras individuales
                const wordBoundaries = /\b[\w']+\b/g;
                translatedText = translatedText.replace(wordBoundaries, (match) => {
                    const lowerMatch = match.toLowerCase();
                    if (words[lowerMatch]) {
                        if (match[0] === match[0].toUpperCase()) {
                            return words[lowerMatch].charAt(0).toUpperCase() + words[lowerMatch].slice(1);
                        }
                        return words[lowerMatch];
                    }
                    return match;
                });
                
                return this.cleanupTranslation(translatedText);
            }

            getCommonPhrases() {
                return {
                    'in this chapter': 'en este cap√≠tulo',
                    'as we can see': 'como podemos ver',
                    'it is important to note': 'es importante se√±alar',
                    'on the other hand': 'por otro lado',
                    'in conclusion': 'en conclusi√≥n',
                    'for example': 'por ejemplo',
                    'that is to say': 'es decir',
                    'in other words': 'en otras palabras',
                    'according to': 'seg√∫n',
                    'based on': 'basado en',
                    'as a result': 'como resultado',
                    'in addition': 'adem√°s',
                    'furthermore': 'adem√°s',
                    'therefore': 'por lo tanto',
                    'however': 'sin embargo',
                    'nevertheless': 'no obstante',
                    'in spite of': 'a pesar de',
                    'because of': 'debido a',
                    'in order to': 'para',
                    'so that': 'para que',
                    'as well as': 'as√≠ como',
                    'not only': 'no solo',
                    'but also': 'sino tambi√©n',
                    'such as': 'tales como',
                    'rather than': 'en lugar de',
                    'instead of': 'en lugar de',
                    'in terms of': 'en t√©rminos de',
                    'with respect to': 'con respecto a',
                    'at the same time': 'al mismo tiempo',
                    'first of all': 'en primer lugar',
                    'to sum up': 'en resumen',
                    'in summary': 'en resumen'
                };
            }

            getCommonWords() {
                return {
                    // Art√≠culos y determinantes
                    'the': 'el', 'a': 'un', 'an': 'una', 'this': 'este', 'that': 'ese', 'these': 'estos', 'those': 'esos',
                    'some': 'algunos', 'any': 'cualquier', 'all': 'todos', 'every': 'cada', 'each': 'cada',
                    'much': 'mucho', 'many': 'muchos', 'few': 'pocos', 'little': 'poco', 'most': 'la mayor√≠a',
                    
                    // Pronombres
                    'i': 'yo', 'you': 't√∫', 'he': '√©l', 'she': 'ella', 'it': 'eso', 'we': 'nosotros', 'they': 'ellos',
                    'me': 'me', 'him': '√©l', 'her': 'ella', 'us': 'nos', 'them': 'ellos',
                    'my': 'mi', 'your': 'tu', 'his': 'su', 'our': 'nuestro', 'their': 'su',
                    'who': 'qui√©n', 'what': 'qu√©', 'when': 'cu√°ndo', 'where': 'd√≥nde', 'why': 'por qu√©', 'how': 'c√≥mo',
                    
                    // Verbos principales
                    'be': 'ser', 'is': 'es', 'am': 'soy', 'are': 'son', 'was': 'era', 'were': 'eran', 'been': 'sido',
                    'have': 'tener', 'has': 'tiene', 'had': 'ten√≠a', 'having': 'teniendo',
                    'do': 'hacer', 'does': 'hace', 'did': 'hizo', 'done': 'hecho', 'doing': 'haciendo',
                    'will': 'ser√°', 'would': 'har√≠a', 'should': 'deber√≠a', 'could': 'podr√≠a', 'might': 'podr√≠a',
                    'can': 'puede', 'must': 'debe', 'may': 'puede',
                    'go': 'ir', 'come': 'venir', 'see': 'ver', 'know': 'saber', 'think': 'pensar', 'say': 'decir',
                    'tell': 'decir', 'get': 'obtener', 'give': 'dar', 'take': 'tomar', 'make': 'hacer',
                    'want': 'querer', 'need': 'necesitar', 'try': 'intentar', 'use': 'usar', 'work': 'trabajar',
                    'live': 'vivir', 'play': 'jugar', 'look': 'mirar', 'find': 'encontrar', 'feel': 'sentir',
                    'seem': 'parecer', 'become': 'convertirse', 'leave': 'dejar', 'put': 'poner', 'call': 'llamar',
                    
                    // Conjunciones y preposiciones
                    'and': 'y', 'or': 'o', 'but': 'pero', 'if': 'si', 'unless': 'a menos que', 'because': 'porque',
                    'since': 'desde', 'while': 'mientras', 'when': 'cuando', 'after': 'despu√©s', 'before': 'antes',
                    'until': 'hasta', 'although': 'aunque', 'though': 'aunque', 'even': 'incluso',
                    'with': 'con', 'without': 'sin', 'for': 'para', 'from': 'de', 'to': 'a', 'in': 'en',
                    'on': 'en', 'at': 'en', 'by': 'por', 'of': 'de', 'about': 'sobre', 'under': 'bajo',
                    'over': 'sobre', 'above': 'arriba', 'below': 'abajo', 'between': 'entre', 'among': 'entre',
                    'through': 'a trav√©s', 'during': 'durante', 'within': 'dentro', 'outside': 'fuera',
                    
                    // Adverbios comunes
                    'very': 'muy', 'really': 'realmente', 'quite': 'bastante', 'too': 'demasiado', 'enough': 'suficiente',
                    'almost': 'casi', 'just': 'solo', 'only': 'solo', 'also': 'tambi√©n', 'even': 'incluso',
                    'still': 'todav√≠a', 'yet': 'a√∫n', 'already': 'ya', 'again': 'otra vez',
                    'always': 'siempre', 'never': 'nunca', 'sometimes': 'a veces', 'often': 'a menudo',
                    'here': 'aqu√≠', 'there': 'all√≠', 'everywhere': 'en todas partes',
                    'today': 'hoy', 'yesterday': 'ayer', 'tomorrow': 'ma√±ana', 'now': 'ahora', 'then': 'entonces',
                    'well': 'bien', 'bad': 'mal', 'fast': 'r√°pido', 'slow': 'lento',
                    
                    // Palabras acad√©micas
                    'research': 'investigaci√≥n', 'study': 'estudio', 'analysis': 'an√°lisis', 'method': 'm√©todo',
                    'approach': 'enfoque', 'theory': 'teor√≠a', 'concept': 'concepto', 'idea': 'idea',
                    'principle': 'principio', 'rule': 'regla', 'fact': 'hecho', 'evidence': 'evidencia',
                    'result': 'resultado', 'conclusion': 'conclusi√≥n', 'solution': 'soluci√≥n', 'problem': 'problema',
                    'question': 'pregunta', 'answer': 'respuesta', 'example': 'ejemplo', 'case': 'caso',
                    'data': 'datos', 'information': 'informaci√≥n', 'knowledge': 'conocimiento',
                    'process': 'proceso', 'step': 'paso', 'stage': 'etapa', 'level': 'nivel',
                    'chapter': 'cap√≠tulo', 'page': 'p√°gina', 'word': 'palabra', 'text': 'texto',
                    'book': 'libro', 'document': 'documento', 'paper': 'art√≠culo', 'report': 'informe',
                    'student': 'estudiante', 'teacher': 'profesor', 'school': 'escuela', 'university': 'universidad',
                    'education': 'educaci√≥n', 'learning': 'aprendizaje', 'teaching': 'ense√±anza',
                    'science': 'ciencia', 'technology': 'tecnolog√≠a', 'computer': 'computadora',
                    'development': 'desarrollo', 'progress': 'progreso', 'improvement': 'mejora',
                    'change': 'cambio', 'growth': 'crecimiento', 'increase': 'aumento',
                    'important': 'importante', 'significant': 'significativo', 'major': 'principal',
                    'general': 'general', 'specific': 'espec√≠fico', 'particular': 'particular',
                    'new': 'nuevo', 'old': 'viejo', 'modern': 'moderno', 'current': 'actual',
                    'good': 'bueno', 'bad': 'malo', 'big': 'grande', 'small': 'peque√±o',
                    'high': 'alto', 'low': 'bajo', 'long': 'largo', 'short': 'corto',
                    'first': 'primero', 'last': '√∫ltimo', 'next': 'siguiente', 'previous': 'anterior',
                    'time': 'tiempo', 'year': 'a√±o', 'month': 'mes', 'day': 'd√≠a',
                    'world': 'mundo', 'country': 'pa√≠s', 'place': 'lugar', 'area': '√°rea',
                    'people': 'gente', 'person': 'persona', 'man': 'hombre', 'woman': 'mujer',
                    'life': 'vida', 'work': 'trabajo', 'business': 'negocio', 'company': 'empresa',
                    'system': 'sistema', 'organization': 'organizaci√≥n', 'group': 'grupo', 'team': 'equipo'
                };
            }

            async translateWithGoogle(text, apiKey) {
                try {
                    const chunks = this.splitTextIntoChunks(text, 1000);
                    let translatedChunks = [];

                    for (const chunk of chunks) {
                        const url = `https://translation.googleapis.com/language/translate/v2?key=${apiKey}`;
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                q: chunk,
                                source: 'en',
                                target: 'es',
                                format: 'text'
                            })
                        });

                        const data = await response.json();
                        
                        if (data.data && data.data.translations && data.data.translations[0]) {
                            translatedChunks.push(data.data.translations[0].translatedText);
                        } else {
                            throw new Error('Respuesta inv√°lida de Google Translate');
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }

                    return translatedChunks.join(' ');
                } catch (error) {
                    console.error('Error con Google Translate:', error);
                    throw error;
                }
            }

            splitTextIntoChunks(text, maxLength) {
                const sentences = text.split(/[.!?]+/);
                const chunks = [];
                let currentChunk = '';

                for (const sentence of sentences) {
                    if ((currentChunk + sentence).length > maxLength && currentChunk.length > 0) {
                        chunks.push(currentChunk.trim());
                        currentChunk = sentence;
                    } else {
                        currentChunk += sentence + '. ';
                    }
                }

                if (currentChunk.trim().length > 0) {
                    chunks.push(currentChunk.trim());
                }

                return chunks;
            }

            translateWithLocalDictionary(text) {
                const basicWords = {
                    'the': 'el', 'a': 'un', 'an': 'una', 'and': 'y', 'or': 'o', 'but': 'pero',
                    'is': 'es', 'are': 'son', 'was': 'era', 'were': 'eran', 'be': 'ser',
                    'have': 'tener', 'has': 'tiene', 'had': 'ten√≠a', 'will': 'ser√°',
                    'can': 'puede', 'do': 'hacer', 'go': 'ir', 'see': 'ver', 'know': 'saber',
                    'i': 'yo', 'you': 't√∫', 'he': '√©l', 'she': 'ella', 'we': 'nosotros', 'they': 'ellos',
                    'this': 'este', 'that': 'ese', 'with': 'con', 'for': 'para', 'from': 'de',
                    'chapter': 'cap√≠tulo', 'book': 'libro', 'page': 'p√°gina', 'example': 'ejemplo',
                    'important': 'importante', 'study': 'estudio', 'student': 'estudiante'
                };

                const words = text.split(/(\s+|[.,;:!?()-])/);
                const translatedWords = words.map(word => {
                    const cleanWord = word.toLowerCase().replace(/[.,;:!?()-]/g, '');
                    if (basicWords[cleanWord]) {
                        return word.replace(new RegExp(cleanWord, 'gi'), basicWords[cleanWord]);
                    }
                    return word;
                });

                return translatedWords.join('');
            }

            cleanupTranslation(text) {
                return text
                    .replace(/\s+/g, ' ')
                    .replace(/\s+([.,;:!?])/g, '$1')
                    .trim();
            }

            showPreview() {
                this.previewSection.style.display = 'block';
                this.currentPage = 1;
                this.renderCurrentPage();
                this.updateNavigationButtons();
                this.downloadButton.style.display = 'block';
            }

            async renderCurrentPage() {
                if (!this.translatedPages[this.currentPage - 1]) return;

                const pageData = this.translatedPages[this.currentPage - 1];
                const page = pageData.page;
                const viewport = pageData.viewport;

                const originalContext = this.originalCanvas.getContext('2d');
                this.originalCanvas.width = viewport.width;
                this.originalCanvas.height = viewport.height;

                await page.render({
                    canvasContext: originalContext,
                    viewport: viewport
                }).promise;

                await this.renderTranslatedPage(pageData);

                this.pageInfo.textContent = `P√°gina ${this.currentPage} de ${this.totalPages}`;
            }

            async renderTranslatedPage(pageData) {
                const context = this.translatedCanvas.getContext('2d');
                const viewport = pageData.viewport;
                
                this.translatedCanvas.width = viewport.width;
                this.translatedCanvas.height = viewport.height;

                context.fillStyle = 'white';
                context.fillRect(0, 0, viewport.width, viewport.height);

                await pageData.page.render({
                    canvasContext: context,
                    viewport: viewport
                }).promise;

                context.fillStyle = 'rgba(255, 255, 255, 0.95)';
                context.fillRect(0, 0, viewport.width, viewport.height);

                const fontSize = Math.max(12, viewport.width / 50);
                context.font = `${fontSize}px Arial, sans-serif`;
                context.fillStyle = '#333';
                context.textAlign = 'left';
                context.textBaseline = 'top';

                const margin = 40;
                const lineHeight = fontSize * 1.4;
                const maxWidth = viewport.width - (margin * 2);
                
                const paragraphs = pageData.translatedText.split('\n');
                let yPosition = margin;

                for (const paragraph of paragraphs) {
                    if (yPosition > viewport.height - margin) break;
                    
                    const lines = this.wrapText(context, paragraph, maxWidth);
                    
                    for (const line of lines) {
                        if (yPosition > viewport.height - margin) break;
                        context.fillText(line, margin, yPosition);
                        yPosition += lineHeight;
                    }
                    
                    yPosition += lineHeight / 2;
                }
            }

            wrapText(context, text, maxWidth) {
                const words = text.split(' ');
                const lines = [];
                let currentLine = '';

                for (const word of words) {
                    const testLine = currentLine + word + ' ';
                    const metrics = context.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine !== '') {
                        lines.push(currentLine.trim());
                        currentLine = word + ' ';
                    } else {
                        currentLine = testLine;
                    }
                }
                
                if (currentLine.trim() !== '') {
                    lines.push(currentLine.trim());
                }

                return lines;
            }

            navigatePage(direction) {
                const newPage = this.currentPage + direction;
                if (newPage >= 1 && newPage <= this.totalPages) {
                    this.currentPage = newPage;
                    this.renderCurrentPage();
                    this.updateNavigationButtons();
                }
            }

            updateNavigationButtons() {
                this.prevButton.disabled = this.currentPage <= 1;
                this.nextButton.disabled = this.currentPage >= this.totalPages;
            }

            downloadTranslatedPDF() {
                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'pt', 'a4');

                    this.translatedPages.forEach((pageData, index) => {
                        if (index > 0) {
                            pdf.addPage();
                        }
                        
                        pdf.setFont('helvetica', 'normal');
                        pdf.setFontSize(12);
                        
                        const paragraphs = pageData.translatedText.split('\n');
                        let yPosition = 50;
                        const margin = 40;
                        const pageWidth = 595 - (margin * 2);
                        const lineHeight = 18;
                        
                        for (const paragraph of paragraphs) {
                            if (yPosition > 750) {
                                pdf.addPage();
                                yPosition = 50;
                            }
                            
                            const lines = pdf.splitTextToSize(paragraph, pageWidth);
                            
                            for (const line of lines) {
                                if (yPosition > 750) {
                                    pdf.addPage();
                                    yPosition = 50;
                                }
                                pdf.text(line, margin, yPosition);
                                yPosition += lineHeight;
                            }
                            
                            yPosition += lineHeight / 2;
                        }
                    });

                    pdf.setProperties({
                        title: 'Libro Traducido al Espa√±ol',
                        subject: 'Traducci√≥n autom√°tica PDF',
                        author: 'PDF Translator App',
                        creator: 'PDF Translator'
                    });

                    pdf.save('libro-traducido-espanol.pdf');
                    this.showStatus('¬°PDF descargado exitosamente!', 'success');
                } catch (error) {
                    console.error('Error al generar PDF:', error);
                    this.showStatus('Error al generar el PDF. Intenta nuevamente.', 'error');
                }
            }

            updateProgress(percent, message) {
                this.progressFill.style.width = `${percent}%`;
                this.progressText.textContent = message;
            }

            showProgress(show) {
                this.progressContainer.style.display = show ? 'block' : 'none';
                if (!show) {
                    this.progressFill.style.width = '0%';
                }
            }

            showStatus(message, type) {
                this.statusMessage.innerHTML = `<div class="status-${type}">${message}</div>`;
                setTimeout(() => {
                    this.statusMessage.innerHTML = '';
                }, type === 'error' ? 8000 : 5000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new PDFTranslator();
        });
    </script>
</body>
</html>